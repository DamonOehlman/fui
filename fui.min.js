(function(a){function d(a,b,c){if(a.offsetParent)do b-=a.offsetLeft,c-=a.offsetTop,a=a.offsetParent;while(a);return{x:b,y:c}}function e(a,b){var c=a.target||a.srcElement,d=c.className;while(c&&c!==b)c=c.parentNode;return c&&c===b}function i(){this._index=0,this._steps=[],this.state={}}function j(a){var d=b[b.length]=new i,e;return a=a||{},a.source=a.source||("ontouchstart"in window?"touch":"mouse"),e=c[a.souce],e||(e=c[a.source]=new j.sources[a.source](document)),e.add(d),d}function k(){this.chains=[]}var b=[],c={},f=typeof window.attachEvent!="undefined",g=f?function(a,b,c){a.attachEvent("on"+b,c)}:function(a,b,c){a.addEventListener(b,c,!0)},h=f?function(a,b,c){a.detachEvent("on"+b,c)}:function(a,b,c){a.removeEventListener(b,c,!0)};i.prototype={_next:function(a){var b=this._steps[this._index++];if(typeof b=="function"){var c=b.apply(this,this.args);return typeof c=="undefined"||c}return!1},_on:function(a,b){return this._step(function(){if(this.event.name===a)return b.apply(this,arguments)})},_step:function(a){return this._steps[this._steps.length]=a,this},each:function(a){return this._step(a)},filter:function(a){return this._step(function(b){return qwery.is(b,a)})},relative:function(){return this._step(function(a,b,c){if(a.offsetParent)do b-=a.offsetLeft,c-=a.offsetTop,a=a.offsetParent;while(a);this.args=this.args.slice(0,1).concat([b,c])})},process:function(a){var b;this._index=0,this.event=a,this.args=[a.target,a.pageX,a.pageY];do b=this._next(a);while(b);return b}},["down","up","move"].forEach(function(a){i.prototype[a]=function(b){return this._on(a,b)}}),j.sources={},k.prototype={add:function(a){this.chains.push(a)},pipe:function(a){var b=this;return function(c){c.target=c.target||c.sourceElement,c.name=a;for(var d=b.chains.length;d--;)b.chains[d].process(c)}}};var l=j.sources.mouse=function(a){k.call(this,a),this._bindEvents(a)};l.prototype=new k,l.prototype.constructor=l,l.prototype._bindEvents=function(a){var b=this;g(a,"mousedown",b.pipe("down")),g(a,"mousemove",b.pipe("move")),g(a,"mouseup",b.pipe("up"))},typeof module!="undefined"&&module.exports?module.exports=j:typeof define!="undefined"?define("fui",[],function(){return j}):a.fui=j})(this)