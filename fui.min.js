(function(a){function g(a){this._index=0,this._relative=!1,this._steps=[],this.state={},this.lastTarget}function h(a){var d=b[b.length]=new g(a),e;a=a||{},a.source=a.source||("ontouchstart"in window?"touch":"mouse"),e=c[a.souce];if(!e){var f=h.sources[a.source];f&&(e=c[a.source]=new f(document))}return e&&e.add(d),d}function i(){this.chains=[]}var b=[],c={},d=typeof window.attachEvent!="undefined",e=d?function(a,b,c){a.attachEvent("on"+b,c)}:function(a,b,c){a.addEventListener(b,c,!0)},f=d?function(a,b,c){a.detachEvent("on"+b,c)}:function(a,b,c){a.removeEventListener(b,c,!0)};g.prototype={_next:function(a){var b=this._steps[this._index++];if(typeof b=="function"){var c=b.apply(this,this.args);return typeof c=="undefined"||c}return!1},_on:function(a,b){return this._step(function(){if(this.event.name===a)return b.apply(this,arguments)})},_step:function(a){return this._steps[this._steps.length]=a,this},each:function(a){return this._step(a)},filter:function(a){return this._step(function(b){return qwery.is(b,a)})},relative:function(){return this._step(function(a,b,c){if(!this._relative){if(a.offsetParent)do b-=a.offsetLeft,c-=a.offsetTop,a=a.offsetParent;while(a);this.args=this.args.slice(0,1).concat([b,c]),this._relative=!0}})},pipe:function(a){return this._step(function(){a.process(this.event)})},process:function(a){var b;this._index=0,this._relative=!1,this.event=a,this.args=[a.target,a.pageX,a.pageY];do b=this._next(a);while(b);return this.lastTarget=a.target,b}},["down","up","move"].forEach(function(a){g.prototype[a]=function(b){return this._on(a,b)}}),h.sources={},h.template=function(a){return a=a||{},a.source="none",h(a)},i.prototype={_createEvent:function(a,b){return{name:a,target:b.target||b.sourceElement,pageX:b.pageX,pageY:b.pageY,original:b}},add:function(a){this.chains.push(a)},handle:function(a){var b=this;return function(c){var d=b._createEvent(a,c);for(var e=b.chains.length;e--;)b.chains[e].process(d)}}};var j=h.sources.mouse=function(a){i.call(this,a),this._bindEvents(a)};j.prototype=new i,j.prototype.constructor=j,j.prototype._bindEvents=function(a){var b=this;e(a,"mousedown",b.handle("down")),e(a,"mousemove",b.handle("move")),e(a,"mouseup",b.handle("up"))},typeof module!="undefined"&&module.exports?module.exports=h:typeof define!="undefined"?define("fui",[],function(){return h}):a.fui=h})(this)